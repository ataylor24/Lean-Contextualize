[{"value":{"range":[1395,1462],"original":true},"type":{"range":[1390,1394],"original":true},"signature":{"range":{"stop":1394,"start":1364},"pp":" {X : Type} (f : X → ℝ) : Prop","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8"]},"ref":{"range":{"stop":1462,"start":1135},"pp":"/-- Definition 8.2.1 (Series on countable sets).  Note that with this definition, functions defined\non finite sets will not be absolutely convergent; one should use `AbsConvergent'` instead for such\ncases.-/\nabbrev AbsConvergent {X : Type} (f : X → ℝ) : Prop :=\n  ∃ g : ℕ → X, Bijective g ∧ (f ∘ g : Series).absConverges","original":true},"params":[{"type":[1367,1371],"ref":[1365,1366],"id":[1365,1366],"bi":"implicit"},{"type":[1377,1386],"ref":[1374,1375],"id":[1374,1375],"bi":"default"}],"name":["Chapter8","AbsConvergent"],"modifiers":null,"kind":"abbrev","id":{"range":[1350,1363],"original":true}},{"value":{"range":[1599,1610],"original":true},"type":{"range":[1583,1598],"original":true},"signature":{"range":{"stop":1598,"start":1489},"pp":" {X : Type} {f : X → ℝ} {g : ℕ → X} (h : Bijective g) (hfg : (f ∘ g : Series).absConverges) : AbsConvergent f","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Chapter8","AbsConvergent"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","AbsConvergent"]},"ref":{"range":{"stop":1610,"start":1464},"pp":"theorem mk {X : Type} {f : X → ℝ} {g : ℕ → X} (h : Bijective g) (hfg : (f ∘ g : Series).absConverges) :\n    AbsConvergent f := by use g","original":true},"params":[{"type":[1493,1497],"ref":[1490,1491],"id":[1490,1491],"bi":"implicit"},{"type":[1502,1511],"ref":[1500,1501],"id":[1500,1501],"bi":"implicit"},{"type":[1516,1525],"ref":[1514,1515],"id":[1514,1515],"bi":"implicit"},{"type":[1531,1542],"ref":[1528,1529],"id":[1528,1529],"bi":"default"},{"type":[1550,1579],"ref":[1545,1548],"id":[1545,1548],"bi":"default"}],"name":["Chapter8","AbsConvergent","mk"],"modifiers":null,"kind":"theorem","id":{"range":[1472,1488],"original":true}},{"value":{"range":[1836,1975],"original":true},"type":{"range":[1832,1835],"original":true},"signature":{"range":{"stop":1835,"start":1806},"pp":" {X : Type} (f : X → ℝ) : ℝ","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Classical"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Classical"],"except":[]}},{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8"]},"ref":{"range":{"stop":1975,"start":1630},"pp":"/-- The definition has been chosen to give a sensible value when `X` is finite, even though\n`AbsConvergent` is by definition false in this context. -/\nnoncomputable abbrev Sum {X : Type} (f : X → ℝ) : ℝ :=\n  if h : AbsConvergent f then (f ∘ h.choose : Series).sum\n  else if _hX : Finite X then (∑ x ∈ @univ X (Fintype.ofFinite X), f x) else 0","original":true},"params":[{"type":[1809,1813],"ref":[1807,1808],"id":[1807,1808],"bi":"implicit"},{"type":[1819,1828],"ref":[1816,1817],"id":[1816,1817],"bi":"default"}],"name":["Chapter8","Sum"],"modifiers":null,"kind":"abbrev","id":{"range":[1802,1805],"original":true}},{"value":{"range":[2097,2286],"original":true},"type":{"range":[2038,2096],"original":true},"signature":{"range":{"stop":2096,"start":1999},"pp":" {X : Type} [hX : Finite X] (f : X → ℝ) : Sum f = ∑ x ∈ @Finset.univ X (Fintype.ofFinite X), f x","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Chapter8","Sum"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","Sum"]},"ref":{"range":{"stop":2286,"start":1977},"pp":"theorem of_finite {X : Type} [hX : Finite X] (f : X → ℝ) : Sum f = ∑ x ∈ @Finset.univ X (Fintype.ofFinite X), f x :=\n  by\n  have : ¬AbsConvergent f := by\n    by_contra!; choose g hg _ using this\n    rw [← hg.finite_iff, ← not_infinite_iff_finite] at hX; apply hX; infer_instance\n  simp [Sum, this, hX]","original":true},"params":[{"type":[2002,2006],"ref":[2000,2001],"id":[2000,2001],"bi":"implicit"},{"type":[2012,2020],"ref":[2009,2011],"id":[2009,2011],"bi":"instImplicit"},{"type":[2025,2034],"ref":[2023,2024],"id":[2023,2024],"bi":"default"}],"name":["Chapter8","Sum","of_finite"],"modifiers":null,"kind":"theorem","id":{"range":[1985,1998],"original":true}},{"value":{"range":[2424,2709],"original":true},"type":{"range":[2394,2423],"original":true},"signature":{"range":{"stop":2423,"start":2315},"pp":" {X : Type} {f : X → ℝ} {g : ℕ → X} (h : Bijective g) (hf : AbsConvergent f) : (f ∘ g : Series).absConverges","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Chapter8","AbsConvergent"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","AbsConvergent"]},"ref":{"range":{"stop":2709,"start":2288},"pp":"theorem comp {X : Type} {f : X → ℝ} {g : ℕ → X} (h : Bijective g) (hf : AbsConvergent f) :\n    (f ∘ g : Series).absConverges := by\n  choose g' hbij hconv using hf\n  choose g'_inv hleft hright using bijective_iff_has_inverse.mp hbij\n  have hG : Bijective (g'_inv ∘ g) := .comp ⟨hright.injective, hleft.surjective⟩ h\n  convert (absConverges_of_permute hconv hG).1 using 4 with n\n  simp [hright (g n.toNat)]","original":true},"params":[{"type":[2319,2323],"ref":[2316,2317],"id":[2316,2317],"bi":"implicit"},{"type":[2328,2337],"ref":[2326,2327],"id":[2326,2327],"bi":"implicit"},{"type":[2342,2351],"ref":[2340,2341],"id":[2340,2341],"bi":"implicit"},{"type":[2357,2368],"ref":[2354,2355],"id":[2354,2355],"bi":"default"},{"type":[2375,2390],"ref":[2371,2373],"id":[2371,2373],"bi":"default"}],"name":["Chapter8","AbsConvergent","comp"],"modifiers":null,"kind":"theorem","id":{"range":[2296,2314],"original":true}},{"value":{"range":[2857,3332],"original":true},"type":{"range":[2820,2856],"original":true},"signature":{"range":{"stop":2856,"start":2726},"pp":" {X : Type} {f : X → ℝ} {g : ℕ → X} (h : Bijective g) (hfg : (f ∘ g : Series).absConverges) :\n  (f ∘ g : Series).convergesTo (Sum f)","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Chapter8","Sum"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","Sum"]},"ref":{"range":{"stop":3332,"start":2711},"pp":"theorem eq {X : Type} {f : X → ℝ} {g : ℕ → X} (h : Bijective g) (hfg : (f ∘ g : Series).absConverges) :\n    (f ∘ g : Series).convergesTo (Sum f) :=\n  by\n  have : AbsConvergent f := .mk h hfg\n  simp [Sum, this]\n  choose hbij hconv using this.choose_spec\n  set g' := this.choose\n  choose g'_inv hleft hright using bijective_iff_has_inverse.mp hbij\n  convert convergesTo_sum (converges_of_absConverges hfg) using 1\n  have hG : Bijective (g'_inv ∘ g) := .comp ⟨hright.injective, hleft.surjective⟩ h\n  convert (absConverges_of_permute hconv hG).2 using 4 with _ n\n  by_cases hn : n ≥ 0 <;> simp [hn, hright (g n.toNat)]","original":true},"params":[{"type":[2730,2734],"ref":[2727,2728],"id":[2727,2728],"bi":"implicit"},{"type":[2739,2748],"ref":[2737,2738],"id":[2737,2738],"bi":"implicit"},{"type":[2753,2762],"ref":[2751,2752],"id":[2751,2752],"bi":"implicit"},{"type":[2768,2779],"ref":[2765,2766],"id":[2765,2766],"bi":"default"},{"type":[2787,2816],"ref":[2782,2785],"id":[2782,2785],"bi":"default"}],"name":["Chapter8","Sum","eq"],"modifiers":null,"kind":"theorem","id":{"range":[2719,2725],"original":true}},{"value":{"range":[3485,3989],"original":true},"type":{"range":[3435,3484],"original":true},"signature":{"range":{"stop":3484,"start":3354},"pp":" {X Y : Type} {f : X → ℝ} (h : AbsConvergent f) {g : Y → X} (hbij : Bijective g) :\n  AbsConvergent (f ∘ g) ∧ Sum f = Sum (f ∘ g)","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Chapter8","Sum"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","Sum"]},"ref":{"range":{"stop":3989,"start":3334},"pp":"theorem of_comp {X Y : Type} {f : X → ℝ} (h : AbsConvergent f) {g : Y → X} (hbij : Bijective g) :\n    AbsConvergent (f ∘ g) ∧ Sum f = Sum (f ∘ g) :=\n  by\n  choose g' hbij' hconv' using h\n  choose g_inv hleft hright using bijective_iff_has_inverse.mp hbij\n  have hbij_g_inv_g' : Bijective (g_inv ∘ g') := .comp ⟨hright.injective, hleft.surjective⟩ hbij'\n  have hident : (f ∘ g) ∘ g_inv ∘ g' = f ∘ g' := by ext n; simp [hright (g' n)]\n  refine ⟨⟨g_inv ∘ g', ⟨hbij_g_inv_g', by convert hconv'⟩⟩, ?_⟩\n  have h := eq (f := f ∘ g) hbij_g_inv_g' (by convert hconv')\n  rw [hident] at h\n  solve_by_elim [convergesTo_uniq, eq]","original":true},"params":[{"type":[3359,3363],"ref":[3355,3356],"id":[3355,3356],"bi":"implicit"},{"type":[3359,3363],"ref":[3357,3358],"id":[3357,3358],"bi":"implicit"},{"type":[3368,3377],"ref":[3366,3367],"id":[3366,3367],"bi":"implicit"},{"type":[3383,3398],"ref":[3380,3381],"id":[3380,3381],"bi":"default"},{"type":[3404,3411],"ref":[3401,3402],"id":[3401,3402],"bi":"implicit"},{"type":[3420,3431],"ref":[3414,3418],"id":[3414,3418],"bi":"default"}],"name":["Chapter8","Sum","of_comp"],"modifiers":null,"kind":"theorem","id":{"range":[3342,3353],"original":true}},{"value":{"range":[4085,4227],"original":true},"type":{"range":[4036,4084],"original":true},"signature":{"range":{"stop":4084,"start":4026},"pp":" (N : ℕ) : Icc 0 (N : ℤ) = map Nat.castEmbedding (.Icc 0 N)","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter8","Finset"],["Chapter7","Series"],["Chapter8"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","Finset"]},"ref":{"range":{"stop":4227,"start":3991},"pp":"@[simp]\ntheorem Icc_eq_cast (N : ℕ) : Icc 0 (N : ℤ) = map Nat.castEmbedding (.Icc 0 N) :=\n  by\n  ext n; simp; constructor\n  . intro ⟨hn, _⟩; lift n to ℕ using hn; use n; simp_all\n  rintro ⟨_, ⟨_, rfl⟩⟩; simp_all","original":true},"params":[{"type":[4029,4032],"ref":[4027,4028],"id":[4027,4028],"bi":"default"}],"name":["Chapter8","Finset","Icc_eq_cast"],"modifiers":null,"kind":"theorem","id":{"range":[4007,4025],"original":true}},{"value":{"range":[4294,4344],"original":true},"type":{"range":[4280,4293],"original":true},"signature":{"range":{"stop":4293,"start":4254},"pp":" {N : ℤ} (h : ¬N ≥ 0) : Icc 0 N = ∅","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter8","Finset"],["Chapter7","Series"],["Chapter8"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","Finset"]},"ref":{"range":{"stop":4344,"start":4229},"pp":"theorem Icc_empty {N : ℤ} (h : ¬N ≥ 0) : Icc 0 N = ∅ := by ext; simp; intros; contrapose! h; linarith","original":true},"params":[{"type":[4257,4260],"ref":[4255,4256],"id":[4255,4256],"bi":"implicit"},{"type":[4266,4276],"ref":[4263,4264],"id":[4263,4264],"bi":"default"}],"name":["Chapter8","Finset","Icc_empty"],"modifiers":null,"kind":"theorem","id":{"range":[4237,4253],"original":true}},{"value":{"range":[4699,7543],"original":true},"type":{"range":[4571,4698],"original":true},"signature":{"range":{"stop":4698,"start":4491},"pp":" {f : ℕ × ℕ → ℝ} (hf : AbsConvergent f) (hpos : ∀ n m, 0 ≤ f (n, m)) :\n  (∀ n, ((fun m ↦ f (n, m)) : Series).converges) ∧\n    (fun n ↦ ((fun m ↦ f (n, m)) : Series).sum : Series).convergesTo (Sum f)","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8"]},"ref":{"range":{"stop":7543,"start":4346},"pp":"/-- Theorem 8.2.2, preliminary version.  The arguments here are rearranged slightly from the text. -/\ntheorem sum_of_sum_of_AbsConvergent_nonneg {f : ℕ × ℕ → ℝ} (hf : AbsConvergent f) (hpos : ∀ n m, 0 ≤ f (n, m)) :\n    (∀ n, ((fun m ↦ f (n, m)) : Series).converges) ∧\n      (fun n ↦ ((fun m ↦ f (n, m)) : Series).sum : Series).convergesTo (Sum f) :=\n  by\n  set L := Sum f\n  set a : ℕ → Series := fun n ↦ ((fun m ↦ f (n, m)) : Series)\n  have hLpos : 0 ≤ L := by simp [L, Sum, hf]; apply sum_of_nonneg; intro n; by_cases h : n ≥ 0 <;> simp [h]; grind\n  have hfinsum (X : Finset (ℕ × ℕ)) : ∑ p ∈ X, f p ≤ L := by sorry\n  have hfinsum' (n M : ℕ) : (a n).partial M ≤ L :=\n    by\n    simp [a, Series.partial, Finset.Icc_eq_cast]\n    convert_to ∑ x ∈ .map (Embedding.sectR n ℕ) (.Icc 0 M), f x ≤ L\n    . simp\n    solve_by_elim\n  have hnon (n : ℕ) : (a n).nonneg := by simp [a, nonneg]; intro m; split_ifs <;> simp [hpos]\n  have hconv (n : ℕ) : (a n).converges := by\n    rw [converges_of_nonneg_iff (hnon n)]\n    use L; intro N; by_cases h : N ≥ 0\n    . lift N to ℕ using h; solve_by_elim\n    rw [partial_of_lt (by simp [a]; linarith)]; simp [hLpos]\n  have (N M : ℤ) : ∑ n ∈ Icc 0 N, (a n.toNat).partial M ≤ L :=\n    by\n    by_cases hN : N ≥ 0; swap\n    . simp [Finset.Icc_empty hN, hLpos]\n    lift N to ℕ using hN\n    by_cases hM : M ≥ 0; swap\n    . convert hLpos; unfold Series.partial\n      apply sum_eq_zero; intro n _\n      simp [a, Finset.Icc_empty hM]\n    lift M to ℕ using hM\n    convert_to ∑ x ∈ (Icc 0 N) ×ˢ (.Icc 0 M), f x ≤ L\n    . simp [a, sum_product, Series.partial]\n    solve_by_elim\n  replace (N : ℤ) : ∑ n ∈ Icc 0 N, (a n.toNat).sum ≤ L :=\n    by\n    apply le_of_tendsto' (x := .atTop) (tendsto_finset_sum _ _) (this N)\n    solve_by_elim [convergesTo_sum]\n  replace (N : ℤ) : (fun n ↦ (a n).sum : Series).partial N ≤ L := by convert this N with n hn; simp_all\n  have hnon' : (fun n ↦ (a n).sum : Series).nonneg := by\n    intro n; simp; split_ifs\n    . exact sum_of_nonneg (hnon n.toNat)\n    simp\n  have hconv' : (fun n ↦ (a n).sum : Series).converges := by rw [converges_of_nonneg_iff hnon']; use L\n  replace : (fun n ↦ (a n).sum : Series).sum ≤ L := le_of_tendsto' (convergesTo_sum hconv') this\n  replace : (fun n ↦ (a n).sum : Series).sum = L :=\n    by\n    apply le_antisymm this (le_of_forall_sub_le _); intro ε hε\n    replace : ∃ X, ∑ p ∈ X, f p ≥ L - ε := by sorry\n    choose X hX using this\n    have : ∃ N, ∃ M, X ⊆ (Icc 0 N) ×ˢ (Icc 0 M) := by sorry\n    choose N M hX' using this\n    calc\n      _ ≤ ∑ p ∈ X, f p := hX\n      _ ≤ ∑ p ∈ (Icc 0 N) ×ˢ (Icc 0 M), f p := (sum_le_sum_of_subset_of_nonneg hX' (by solve_by_elim))\n      _ = ∑ n ∈ Icc 0 N, ∑ m ∈ Icc 0 M, f (n, m) := (sum_product _ _ _)\n      _ ≤ ∑ n ∈ Icc 0 N, (a n).sum := by\n        apply sum_le_sum; intro n _\n        convert partial_le_sum_of_nonneg (hnon n) (hconv n) M\n        simp [a, Series.partial]\n      _ = (fun n ↦ (a n).sum : Series).partial N := by simp [Series.partial]\n      _ ≤ _ := partial_le_sum_of_nonneg hnon' hconv' _\n  simp [a, hconv, ← this, Series.convergesTo_sum hconv']","original":true},"params":[{"type":[4494,4512],"ref":[4492,4493],"id":[4492,4493],"bi":"implicit"},{"type":[4518,4533],"ref":[4515,4517],"id":[4515,4517],"bi":"default"},{"type":[4542,4565],"ref":[4536,4540],"id":[4536,4540],"bi":"default"}],"name":["Chapter8","sum_of_sum_of_AbsConvergent_nonneg"],"modifiers":null,"kind":"theorem","id":{"range":[4456,4490],"original":true}},{"value":{"range":[7797,9491],"original":true},"type":{"range":[7666,7796],"original":true},"signature":{"range":{"stop":7796,"start":7618},"pp":" {f : ℕ × ℕ → ℝ} (hf : AbsConvergent f) :\n  (∀ n, ((fun m ↦ f (n, m)) : Series).absConverges) ∧\n    (fun n ↦ ((fun m ↦ f (n, m)) : Series).sum : Series).convergesTo (Sum f)","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8"]},"ref":{"range":{"stop":9491,"start":7545},"pp":"/-- Theorem 8.2.2, second version -/\ntheorem sum_of_sum_of_AbsConvergent {f : ℕ × ℕ → ℝ} (hf : AbsConvergent f) :\n    (∀ n, ((fun m ↦ f (n, m)) : Series).absConverges) ∧\n      (fun n ↦ ((fun m ↦ f (n, m)) : Series).sum : Series).convergesTo (Sum f) :=\n  by\n  set fplus := max f 0\n  set fminus := max (-f) 0\n  have hfplus_nonneg : ∀ n m, 0 ≤ fplus (n, m) := by intro n m; simp [fplus]\n  have hfminus_nonneg : ∀ n m, 0 ≤ fminus (n, m) := by intro n m; simp [fminus]\n  have hdiff : f = fplus - fminus := by sorry\n  have hfplus_conv : AbsConvergent fplus := by sorry\n  have hfminus_conv : AbsConvergent fminus := by sorry\n  choose hfplus_conv' hfplus_sum using sum_of_sum_of_AbsConvergent_nonneg hfplus_conv hfplus_nonneg\n  choose hfminus_conv' hfminus_sum using sum_of_sum_of_AbsConvergent_nonneg hfminus_conv hfminus_nonneg\n  split_ands\n  . intro n\n    sorry\n  convert convergesTo.sub hfplus_sum hfminus_sum using 1\n  . -- encountered surprising difficulty with definitional equivalence here\n    \n    simp [hdiff]\n    change\n      (fun n ↦ ((fun m ↦ (fplus - fminus) (n, m)) : Series).sum : Series) =\n        (fun n ↦ ((fun m ↦ fplus (n, m)) : Series).sum : Series) -\n          (fun n ↦ ((fun m ↦ (fminus) (n, m)) : Series).sum : Series)\n    convert_to\n      (fun n ↦ ((fun m ↦ (fplus - fminus) (n, m)) : Series).sum : Series) =\n        (((fun n ↦ ((fun m ↦ fplus (n, m)) : Series).sum) - (fun n ↦ ((fun m ↦ (fminus) (n, m)) : Series).sum) :\n            ℕ → ℝ) :\n          Series)\n    . convert sub_coe _ _\n    rcongr _ n; simp\n    convert (sub _ _).2 with m; rfl\n    split_ifs with h <;> simp [h, HSub.hSub, Sub.sub]\n    . solve_by_elim\n    convert hfminus_conv' n.toNat\n  have ⟨g, hg, _⟩ := hf\n  have h1 := Sum.eq hg (hf.comp hg)\n  have hplus := Sum.eq hg (hfplus_conv.comp hg)\n  have hminus := Sum.eq hg (hfminus_conv.comp hg)\n  apply convergesTo_uniq h1 _\n  convert (convergesTo.sub hplus hminus) using 3 with n\n  split_ifs with h <;> simp [h, hdiff, HSub.hSub, Sub.sub]","original":true},"params":[{"type":[7621,7639],"ref":[7619,7620],"id":[7619,7620],"bi":"implicit"},{"type":[7645,7660],"ref":[7642,7644],"id":[7642,7644],"bi":"default"}],"name":["Chapter8","sum_of_sum_of_AbsConvergent"],"modifiers":null,"kind":"theorem","id":{"range":[7590,7617],"original":true}},{"value":{"range":[9745,10065],"original":true},"type":{"range":[9614,9744],"original":true},"signature":{"range":{"stop":9744,"start":9566},"pp":" {f : ℕ × ℕ → ℝ} (hf : AbsConvergent f) :\n  (∀ m, ((fun n ↦ f (n, m)) : Series).absConverges) ∧\n    (fun m ↦ ((fun n ↦ f (n, m)) : Series).sum : Series).convergesTo (Sum f)","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8"]},"ref":{"range":{"stop":10065,"start":9493},"pp":"/-- Theorem 8.2.2, third version -/\ntheorem sum_of_sum_of_AbsConvergent' {f : ℕ × ℕ → ℝ} (hf : AbsConvergent f) :\n    (∀ m, ((fun n ↦ f (n, m)) : Series).absConverges) ∧\n      (fun m ↦ ((fun n ↦ f (n, m)) : Series).sum : Series).convergesTo (Sum f) :=\n  by\n  set π : ℕ × ℕ → ℕ × ℕ := fun p ↦ (p.2, p.1)\n  have hπ : Bijective π := Involutive.bijective (congrFun rfl)\n  have ⟨g, hg, hconv⟩ := hf\n  convert sum_of_sum_of_AbsConvergent (f := f ∘ π) _ using 2\n  . exact (Sum.of_comp hf hπ).2\n  refine ⟨_, hπ.comp hg, ?_⟩\n  convert hconv using 2","original":true},"params":[{"type":[9569,9587],"ref":[9567,9568],"id":[9567,9568],"bi":"implicit"},{"type":[9593,9608],"ref":[9590,9592],"id":[9590,9592],"bi":"default"}],"name":["Chapter8","sum_of_sum_of_AbsConvergent'"],"modifiers":null,"kind":"theorem","id":{"range":[9537,9565],"original":true}},{"value":{"range":[10285,10413],"original":true},"type":{"range":[10169,10284],"original":true},"signature":{"range":{"stop":10284,"start":10121},"pp":" {f : ℕ × ℕ → ℝ} (hf : AbsConvergent f) :\n  (fun n ↦ ((fun m ↦ f (n, m)) : Series).sum : Series).sum = (fun m ↦ ((fun n ↦ f (n, m)) : Series).sum : Series).sum","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8"]},"ref":{"range":{"stop":10413,"start":10067},"pp":"/-- Theorem 8.2.2, fourth version -/\ntheorem sum_comm {f : ℕ × ℕ → ℝ} (hf : AbsConvergent f) :\n    (fun n ↦ ((fun m ↦ f (n, m)) : Series).sum : Series).sum =\n      (fun m ↦ ((fun n ↦ f (n, m)) : Series).sum : Series).sum :=\n  by simp [sum_of_converges (sum_of_sum_of_AbsConvergent hf).2, sum_of_converges (sum_of_sum_of_AbsConvergent' hf).2]","original":true},"params":[{"type":[10124,10142],"ref":[10122,10123],"id":[10122,10123],"bi":"implicit"},{"type":[10148,10163],"ref":[10145,10147],"id":[10145,10147],"bi":"default"}],"name":["Chapter8","sum_comm"],"modifiers":null,"kind":"theorem","id":{"range":[10112,10120],"original":true}},{"value":{"range":[10604,10619],"original":true},"type":{"range":[10531,10603],"original":true},"signature":{"range":{"stop":10603,"start":10477},"pp":" {X : Type} (hX : CountablyInfinite X) (f : X → ℝ) : AbsConvergent f ↔ BddAbove ((fun A ↦ ∑ x ∈ A, |f x|) '' .univ)","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Chapter8","AbsConvergent"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","AbsConvergent"]},"ref":{"range":{"stop":10619,"start":10415},"pp":"/-- Lemma 8.2.3 / Exercise 8.2.1 -/\ntheorem iff {X : Type} (hX : CountablyInfinite X) (f : X → ℝ) :\n    AbsConvergent f ↔ BddAbove ((fun A ↦ ∑ x ∈ A, |f x|) '' .univ) := by sorry","original":true},"params":[{"type":[10480,10484],"ref":[10478,10479],"id":[10478,10479],"bi":"implicit"},{"type":[10490,10509],"ref":[10487,10489],"id":[10487,10489],"bi":"default"},{"type":[10516,10525],"ref":[10512,10513],"id":[10512,10513],"bi":"default"}],"name":["Chapter8","AbsConvergent","iff"],"modifiers":null,"kind":"theorem","id":{"range":[10459,10476],"original":true}},{"value":{"range":[10674,10729],"original":true},"type":{"range":[10669,10673],"original":true},"signature":{"range":{"stop":10673,"start":10643},"pp":" {X : Type} (f : X → ℝ) : Prop","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8"]},"ref":{"range":{"stop":10729,"start":10621},"pp":"abbrev AbsConvergent' {X : Type} (f : X → ℝ) : Prop :=\n  BddAbove ((fun A ↦ ∑ x ∈ A, |f x|) '' .univ)","original":true},"params":[{"type":[10646,10650],"ref":[10644,10645],"id":[10644,10645],"bi":"implicit"},{"type":[10656,10665],"ref":[10653,10654],"id":[10653,10654],"bi":"default"}],"name":["Chapter8","AbsConvergent'"],"modifiers":null,"kind":"abbrev","id":{"range":[10628,10642],"original":true}},{"value":{"range":[10817,10948],"original":true},"type":{"range":[10800,10816],"original":true},"signature":{"range":{"stop":10816,"start":10764},"pp":" {X : Type} [Finite X] (f : X → ℝ) : AbsConvergent' f","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Chapter8","AbsConvergent'"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","AbsConvergent'"]},"ref":{"range":{"stop":10948,"start":10731},"pp":"theorem of_finite {X : Type} [Finite X] (f : X → ℝ) : AbsConvergent' f :=\n  by\n  have _ := Fintype.ofFinite X\n  simp [bddAbove_def]; use ∑ x, |f x|; intro A; apply Finset.sum_le_univ_sum_of_nonneg; simp","original":true},"params":[{"type":[10767,10771],"ref":[10765,10766],"id":[10765,10766],"bi":"implicit"},{"type":[10774,10782],"ref":null,"id":null,"bi":"instImplicit"},{"type":[10787,10796],"ref":[10785,10786],"id":[10785,10786],"bi":"default"}],"name":["Chapter8","AbsConvergent'","of_finite"],"modifiers":null,"kind":"theorem","id":{"range":[10739,10763],"original":true}},{"value":{"range":[11130,11680],"original":true},"type":{"range":[11093,11129],"original":true},"signature":{"range":{"stop":11129,"start":11041},"pp":" {X : Type} (hX : CountablyInfinite X) {f : X → ℝ} : AbsConvergent' f ↔ AbsConvergent f","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Chapter8","AbsConvergent'"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","AbsConvergent'"]},"ref":{"range":{"stop":11680,"start":10950},"pp":"/-- Not in textbook, but should have been included. -/\ntheorem of_countable {X : Type} (hX : CountablyInfinite X) {f : X → ℝ} : AbsConvergent' f ↔ AbsConvergent f :=\n  by\n  constructor\n  . intro hf; simp [bddAbove_def] at hf; choose L hL using hf\n    have ⟨g, hg⟩ := hX.symm; refine ⟨g, hg, ?_⟩\n    unfold absConverges; rw [converges_of_nonneg_iff]\n    . use L; intro N; by_cases hN : N ≥ 0\n      . lift N to ℕ using hN\n        set g' := Embedding.mk g hg.1\n        convert hL (map g' (Icc 0 N))\n        simp [Series.partial]; rfl\n      convert hL ∅\n      simp; apply partial_of_lt; grind\n    simp [nonneg]\n    intro n; by_cases h : n ≥ 0 <;> simp [h]\n  intro hf; rwa [AbsConvergent.iff hX f] at hf","original":true},"params":[{"type":[11044,11048],"ref":[11042,11043],"id":[11042,11043],"bi":"implicit"},{"type":[11054,11073],"ref":[11051,11053],"id":[11051,11053],"bi":"default"},{"type":[11078,11087],"ref":[11076,11077],"id":[11076,11077],"bi":"implicit"}],"name":["Chapter8","AbsConvergent'","of_countable"],"modifiers":null,"kind":"theorem","id":{"range":[11013,11040],"original":true}},{"value":{"range":[11839,11854],"original":true},"type":{"range":[11805,11838],"original":true},"signature":{"range":{"stop":11838,"start":11755},"pp":" {X : Type} {f : X → ℝ} (hf : AbsConvergent' f) : AtMostCountable {x | f x ≠ 0}","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Chapter8","AbsConvergent'"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","AbsConvergent'"]},"ref":{"range":{"stop":11854,"start":11682},"pp":"/-- Lemma 8.2.5 / Exercise 8.2.2-/\ntheorem countable_supp {X : Type} {f : X → ℝ} (hf : AbsConvergent' f) : AtMostCountable {x | f x ≠ 0} := by sorry","original":true},"params":[{"type":[11758,11762],"ref":[11756,11757],"id":[11756,11757],"bi":"implicit"},{"type":[11767,11776],"ref":[11765,11766],"id":[11765,11766],"bi":"implicit"},{"type":[11783,11799],"ref":[11779,11781],"id":[11779,11781],"bi":"default"}],"name":["Chapter8","AbsConvergent'","countable_supp"],"modifiers":null,"kind":"theorem","id":{"range":[11725,11754],"original":true}},{"value":{"range":[12029,12152],"original":true},"type":{"range":[11996,12028],"original":true},"signature":{"range":{"stop":12028,"start":11935},"pp":" {X : Type} {f : X → ℝ} (hf : AbsConvergent' f) (A : Set X) : AbsConvergent' (fun x : A ↦ f x)","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Chapter8","AbsConvergent'"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","AbsConvergent'"]},"ref":{"range":{"stop":12152,"start":11856},"pp":"/-- Compare with Mathlib's `Summable.subtype`-/\ntheorem subtype {X : Type} {f : X → ℝ} (hf : AbsConvergent' f) (A : Set X) : AbsConvergent' (fun x : A ↦ f x) :=\n  by\n  apply BddAbove.mono _ hf\n  intro z hz; simp at *; choose A hA using hz\n  use A.map (Embedding.subtype _); simp [hA]","original":true},"params":[{"type":[11938,11942],"ref":[11936,11937],"id":[11936,11937],"bi":"implicit"},{"type":[11947,11956],"ref":[11945,11946],"id":[11945,11946],"bi":"implicit"},{"type":[11963,11979],"ref":[11959,11961],"id":[11959,11961],"bi":"default"},{"type":[11985,11990],"ref":[11982,11983],"id":[11982,11983],"bi":"default"}],"name":["Chapter8","AbsConvergent'","subtype"],"modifiers":null,"kind":"theorem","id":{"range":[11912,11934],"original":true}},{"value":{"range":[12306,12348],"original":true},"type":{"range":[12302,12305],"original":true},"signature":{"range":{"stop":12305,"start":12276},"pp":" {X : Type} (f : X → ℝ) : ℝ","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8"]},"ref":{"range":{"stop":12348,"start":12154},"pp":"/-- A generalized sum.  Note that this will give junk values if `f` is not `AbsConvergent'`. -/\nnoncomputable abbrev Sum' {X : Type} (f : X → ℝ) : ℝ :=\n  Sum (fun x : {x | f x ≠ 0} ↦ f x)","original":true},"params":[{"type":[12279,12283],"ref":[12277,12278],"id":[12277,12278],"bi":"implicit"},{"type":[12289,12298],"ref":[12286,12287],"id":[12286,12287],"bi":"default"}],"name":["Chapter8","Sum'"],"modifiers":null,"kind":"abbrev","id":{"range":[12271,12275],"original":true}},{"value":{"range":[12588,12906],"original":true},"type":{"range":[12562,12587],"original":true},"signature":{"range":{"stop":12587,"start":12497},"pp":" {X : Type} {f : X → ℝ} {A : Finset X} (h : ∀ x ∉ A, f x = 0) : Sum' f = ∑ x ∈ A, f x","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Chapter8","Sum'"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","Sum'"]},"ref":{"range":{"stop":12906,"start":12350},"pp":"/-- Not in textbook, but should have been included (the series laws are significantly harder\nto establish without this) -/\ntheorem of_finsupp {X : Type} {f : X → ℝ} {A : Finset X} (h : ∀ x ∉ A, f x = 0) : Sum' f = ∑ x ∈ A, f x :=\n  by\n  unfold Sum'\n  set E := {x | f x ≠ 0}\n  have hE : E ⊆ A := by intro _; simp [E]; grind\n  have hfin : Finite E := Finite.Set.subset _ hE\n  set E' := E.toFinite.toFinset\n  rw [Sum.of_finite (fun x : E ↦ f x), ← E'.sum_subtype (by simp [E'])]\n  replace hE : E' ⊆ A := by aesop\n  apply sum_subset hE; aesop","original":true},"params":[{"type":[12500,12504],"ref":[12498,12499],"id":[12498,12499],"bi":"implicit"},{"type":[12509,12518],"ref":[12507,12508],"id":[12507,12508],"bi":"implicit"},{"type":[12524,12532],"ref":[12521,12522],"id":[12521,12522],"bi":"implicit"},{"type":[12538,12558],"ref":[12535,12536],"id":[12535,12536],"bi":"default"}],"name":["Chapter8","Sum'","of_finsupp"],"modifiers":null,"kind":"theorem","id":{"range":[12481,12496],"original":true}},{"value":{"range":[13250,16720],"original":true},"type":{"range":[13182,13249],"original":true},"signature":{"range":{"stop":13249,"start":13062},"pp":" {X : Type} {f : X → ℝ} {A : Set X} (hA : CountablyInfinite A) (hfA : ∀ x ∉ A, f x = 0) (hconv : AbsConvergent' f) :\n  AbsConvergent' (fun x : A ↦ f x) ∧ Sum' f = Sum (fun x : A ↦ f x)","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Chapter8","Sum'"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","Sum'"]},"ref":{"range":{"stop":16720,"start":12908},"pp":"/-- Not in textbook, but should have been included (the series laws are significantly harder\nto establish without this) -/\ntheorem of_countable_supp {X : Type} {f : X → ℝ} {A : Set X} (hA : CountablyInfinite A) (hfA : ∀ x ∉ A, f x = 0)\n    (hconv : AbsConvergent' f) : AbsConvergent' (fun x : A ↦ f x) ∧ Sum' f = Sum (fun x : A ↦ f x) := by\n  -- We can adapt the proof of `AbsConvergent'.of_countable` to establish absolute convergence on A.\n  \n  have hconv' : AbsConvergent (fun x : A ↦ f x) := (AbsConvergent'.of_countable hA).mp (hconv.subtype A)\n  rw [AbsConvergent'.of_countable hA]\n  refine ⟨hconv', ?_⟩\n  set E :=\n    {x | f x ≠ 0}\n      -- The main challenge here is to relate a sum on E with a sum on A.  First, we show containment.\n      \n  have hE : E ⊆ A := by intro _; simp [E]; by_contra!;\n    aesop\n      -- Now, we map A back to the natural numbers, thus identifying E with a subset E' of ℕ.\n      \n  choose g hg using hA.symm\n  have hsum := Sum.eq hg (hconv'.comp hg)\n  set E' := {n | ↑(g n) ∈ E}\n  set ι : E' → E := fun ⟨n, hn⟩ ↦ ⟨g n, by aesop⟩\n  have hι : Bijective ι := by\n    split_ands\n    . intro ⟨_, _⟩ ⟨_, _⟩ h; simp [ι, E', Subtype.val_inj] at *; exact hg.1 h\n    . intro ⟨x, hx⟩; choose n hn using hg.2 ⟨_, hE hx⟩; use ⟨n, by aesop⟩;\n      grind\n        -- The cases of infinite and finite E' are handled separately.\n        \n  obtain hE' | hE' := Nat.atMostCountable_subset E'\n  . --   use Nat.monotone_enum_of_infinite to enumerate E'\n        --   show the partial sums of E' are a subsequence of the partial sums of A\n    \n    set hinf : Infinite E' := hE'.toInfinite\n    choose a ha_bij ha_mono using (Nat.monotone_enum_of_infinite E').exists\n    have : atTop.Tendsto (Nat.cast ∘ Subtype.val ∘ a : ℕ → ℤ) atTop :=\n      by\n      apply tendsto_natCast_atTop_atTop.comp (StrictMono.tendsto_atTop _)\n      intro _ _ hnm; simp [ha_mono hnm]\n    apply tendsto_nhds_unique _ (hsum.comp this)\n    have hconv'' : AbsConvergent (fun x : E ↦ f x) :=\n      by\n      rw [← AbsConvergent'.of_countable]\n      . exact hconv.subtype E\n      apply (CountablyInfinite.equiv _).mp hE'; use ι\n    replace := Sum.eq (hι.comp ha_bij) (hconv''.comp (hι.comp ha_bij))\n    convert this.comp tendsto_natCast_atTop_atTop using 1; ext N\n    simp [Series.partial, ι]\n    calc\n      _ = ∑ x ∈ .image (Subtype.val ∘ a) (.Icc 0 N), f ↑(g x) :=\n        by\n        symm; apply sum_subset\n        . intro m hm; simp at hm ⊢; obtain ⟨n, hn, rfl⟩ := hm\n          simp [ha_mono.monotone hn]\n        intro x hx hx'; simp at hx hx'; contrapose! hx'\n        choose n hn using (hι.comp ha_bij).2 ⟨g x, hx'⟩\n        simp [ι, Subtype.val_inj] at hn\n        apply hg.1at hn; subst hn\n        use n; simpa [ha_mono.le_iff_le] using hx\n      _ = _ := by\n        apply sum_image\n        intro _ _ _ _ h; simp [Subtype.val_inj] at h; exact ha_bij.1 h\n  let hEfin : Finite E := hι.finite_iff.mp hE'\n  let hE'fintype : Fintype E' := .ofFinite _\n  let hEfintype : Fintype E := .ofFinite _\n  apply convergesTo_uniq _ hsum\n  simp [Sum.of_finite, Series.convergesTo]\n  apply tendsto_nhds_of_eventually_eq\n  have hE'bound : BddAbove E' := Set.Finite.bddAbove hE'\n  rw [bddAbove_def] at hE'bound; choose N hN using hE'bound\n  rw [eventually_atTop]\n  use N; intro N' hN'\n  lift N' to ℕ using (LE.le.trans (by positivity) hN')\n  simp [Series.partial] at hN' ⊢\n  calc\n    _ = ∑ n ∈ E', f (g n) := by\n      symm; apply sum_subset\n      . intro x hx; simp at *; linarith [hN _ hx]\n      intro _ _ hx'; simpa [E', E] using hx'\n    _ = ∑ n : E', f (g n) := by convert (sum_set_coe _).symm\n    _ = ∑ n, f (ι n) := (sum_congr rfl (by grind))\n    _ = _ := hι.sum_comp (g := fun x ↦ f x)","original":true},"params":[{"type":[13065,13069],"ref":[13063,13064],"id":[13063,13064],"bi":"implicit"},{"type":[13074,13083],"ref":[13072,13073],"id":[13072,13073],"bi":"implicit"},{"type":[13089,13094],"ref":[13086,13087],"id":[13086,13087],"bi":"implicit"},{"type":[13101,13120],"ref":[13097,13099],"id":[13097,13099],"bi":"default"},{"type":[13131,13151],"ref":[13125,13128],"id":[13125,13128],"bi":"default"},{"type":[13161,13177],"ref":[13154,13159],"id":[13154,13159],"bi":"default"}],"name":["Chapter8","Sum'","of_countable_supp"],"modifiers":null,"kind":"theorem","id":{"range":[13039,13061],"original":true}},{"value":{"range":[16925,17882],"original":true},"type":{"range":[16893,16924],"original":true},"signature":{"range":{"stop":16924,"start":16868},"pp":" {X : Type} (f : X → ℝ) : AbsConvergent' f ↔ Summable f","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Chapter8","AbsConvergent'"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","AbsConvergent'"]},"ref":{"range":{"stop":17882,"start":16722},"pp":"/-- Connection with Mathlib's `Summable` property. Some version of this might be suitable\n    for Mathlib? -/\ntheorem iff_Summable {X : Type} (f : X → ℝ) : AbsConvergent' f ↔ Summable f :=\n  by\n  simp [← summable_abs_iff, AbsConvergent']\n  simp [summable_iff_vanishing_norm]\n  classical\n  constructor\n  . intro h ε hε\n    set s := Set.range fun A ↦ ∑ x ∈ A, |f x|\n    have hnon : s.Nonempty := by simp [s]; use 0, ∅; simp\n    have : (sSup s) - ε < sSup s := by linarith\n    simp [lt_csSup_iff h hnon, s] at this; choose S hS using this\n    use S; intro T hT\n    rw [abs_of_nonneg (by positivity)]\n    have : ∑ x ∈ T, |f x| + ∑ x ∈ S, |f x| ≤ sSup s :=\n      by\n      apply ConditionallyCompleteLattice.le_csSup _ _ h\n      simp [s]; exact ⟨T ∪ S, sum_union hT⟩\n    linarith\n  intro h; choose S hS using h 1 (by norm_num)\n  rw [bddAbove_def]\n  use ∑ x ∈ S, |f x| + 1; simp; intro T\n  calc\n    _ = ∑ x ∈ (T ∩ S), |f x| + ∑ x ∈ (T \\ S), |f x| := (sum_inter_add_sum_diff _ _ _).symm\n    _ ≤ _ := by\n      gcongr\n      . exact inter_subset_right\n      apply le_of_lt (lt_of_abs_lt (hS _ disjoint_sdiff_self_left))","original":true},"params":[{"type":[16871,16875],"ref":[16869,16870],"id":[16869,16870],"bi":"implicit"},{"type":[16880,16889],"ref":[16878,16879],"id":[16878,16879],"bi":"default"}],"name":["Chapter8","AbsConvergent'","iff_Summable"],"modifiers":null,"kind":"theorem","id":{"range":[16840,16867],"original":true}},{"value":{"range":[18056,18226],"original":true},"type":{"range":[17995,18055],"original":true},"signature":{"range":{"stop":18055,"start":17973},"pp":" (p : ℤ → Prop) : (∀ᶠ n in .atTop, p n) ↔ ∀ᶠ n : ℕ in .atTop, p ↑n","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter8","Filter","Eventually"],["Chapter8","Filter"],["Chapter7","Series"],["Chapter8"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","Filter","Eventually"]},"ref":{"range":{"stop":18226,"start":17884},"pp":"/-- Maybe suitable for porting to Mathlib?-/\ntheorem int_natCast_atTop (p : ℤ → Prop) : (∀ᶠ n in .atTop, p n) ↔ ∀ᶠ n : ℕ in .atTop, p ↑n :=\n  by\n  refine ⟨Eventually.natCast_atTop, ?_⟩\n  simp [eventually_atTop]\n  intro N hN; use N; intro n hn\n  lift n to ℕ using (by omega)\n  simp at hn; solve_by_elim","original":true},"params":[{"type":[17977,17989],"ref":[17974,17975],"id":[17974,17975],"bi":"default"}],"name":["Chapter8","Filter","Eventually","int_natCast_atTop"],"modifiers":null,"kind":"theorem","id":{"range":[17937,17972],"original":true}},{"value":{"range":[18364,18487],"original":true},"type":{"range":[18309,18363],"original":true},"signature":{"range":{"stop":18363,"start":18269},"pp":" {R : Type} (f : ℤ → R) (l : Filter R) : atTop.Tendsto f l ↔ atTop.Tendsto (f ∘ Nat.cast) l","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter8","Filter"],["Chapter7","Series"],["Chapter8"],["Chapter8","Filter","Tendsto"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","Filter","Tendsto"]},"ref":{"range":{"stop":18487,"start":18228},"pp":"theorem int_natCast_atTop {R : Type} (f : ℤ → R) (l : Filter R) : atTop.Tendsto f l ↔ atTop.Tendsto (f ∘ Nat.cast) l :=\n  by\n  simp [tendsto_iff_eventually]\n  peel with p h\n  simp [← eventually_atTop]\n  convert Eventually.int_natCast_atTop _","original":true},"params":[{"type":[18272,18276],"ref":[18270,18271],"id":[18270,18271],"bi":"implicit"},{"type":[18282,18291],"ref":[18279,18280],"id":[18279,18280],"bi":"default"},{"type":[18297,18305],"ref":[18294,18295],"id":[18294,18295],"bi":"default"}],"name":["Chapter8","Filter","Tendsto","int_natCast_atTop"],"modifiers":null,"kind":"theorem","id":{"range":[18236,18268],"original":true}},{"value":{"range":[18642,19755],"original":true},"type":{"range":[18621,18641],"original":true},"signature":{"range":{"stop":18641,"start":18572},"pp":" {X : Type} (f : X → ℝ) (h : AbsConvergent' f) : Sum' f = ∑' x, f x","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Chapter8","Sum'"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","Sum'"]},"ref":{"range":{"stop":19755,"start":18490},"pp":"/-- Connection with Mathlib's `tsum` (or `Σ'`) operation -/\ntheorem eq_tsum {X : Type} (f : X → ℝ) (h : AbsConvergent' f) : Sum' f = ∑' x, f x :=\n  by\n  set E := {x | f x ≠ 0}\n  obtain hE | hE := h.countable_supp\n  . simp [Sum']\n    choose g hg using hE.symm\n    have : ((f ∘ Subtype.val) ∘ g : Series).absConverges :=\n      by\n      apply AbsConvergent.comp hg\n      simp [← AbsConvergent'.of_countable hE, ]\n      exact h.subtype E\n    replace this := Sum.eq hg this\n    convert convergesTo_uniq this _\n    replace : ∑' x, f x = ∑' n, f (g n) :=\n      calc\n        _ = ∑' x : E, f x := by\n          rw [← tsum_univ f]\n          have hcompl : E = .univ \\ {x | f x = 0} := by aesop\n          convert (tsum_setElem_eq_tsum_setElem_diff _ {x | f x = 0} (by aesop))\n        _ = _ := (Equiv.tsum_eq (Equiv.ofBijective _ hg) _).symm\n    rw [this]\n    unfold convergesTo; rw [Filter.Tendsto.int_natCast_atTop]\n    convert (Summable.tendsto_sum_tsum_nat ?_).comp (tendsto_add_atTop_nat 1) with n\n    . ext N; simp [Series.partial, Nat.range_succ_eq_Icc_zero]\n    rw [AbsConvergent'.iff_Summable] at h\n    exact h.comp_injective (i := Subtype.val ∘ g) (Subtype.val_injective.comp hg.1)\n  rw [of_finsupp (A := E.toFinite.toFinset)]; symm; apply tsum_eq_sum\n  all_goals simp [E]","original":true},"params":[{"type":[18575,18579],"ref":[18573,18574],"id":[18573,18574],"bi":"implicit"},{"type":[18584,18593],"ref":[18582,18583],"id":[18582,18583],"bi":"default"},{"type":[18599,18615],"ref":[18596,18597],"id":[18596,18597],"bi":"default"}],"name":["Chapter8","Sum'","eq_tsum"],"modifiers":null,"kind":"theorem","id":{"range":[18559,18571],"original":true}},{"value":{"range":[19988,20001],"original":true},"type":{"range":[19932,19987],"original":true},"signature":{"range":{"stop":19987,"start":19857},"pp":" {X : Type} {f g : X → ℝ} (hf : AbsConvergent' f) (hg : AbsConvergent' g) :\n  AbsConvergent' (f + g) ∧ Sum' (f + g) = Sum' f + Sum' g","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Chapter8","Sum'"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","Sum'"]},"ref":{"range":{"stop":20001,"start":19758},"pp":"/-- Proposition 8.2.6 (a) (Absolutely convergent series laws) / Exercise 8.2.3 -/\ntheorem add {X : Type} {f g : X → ℝ} (hf : AbsConvergent' f) (hg : AbsConvergent' g) :\n    AbsConvergent' (f + g) ∧ Sum' (f + g) = Sum' f + Sum' g := by sorry","original":true},"params":[{"type":[19860,19864],"ref":[19858,19859],"id":[19858,19859],"bi":"implicit"},{"type":[19871,19880],"ref":[19867,19868],"id":[19867,19868],"bi":"implicit"},{"type":[19871,19880],"ref":[19869,19870],"id":[19869,19870],"bi":"implicit"},{"type":[19887,19903],"ref":[19883,19885],"id":[19883,19885],"bi":"default"},{"type":[19910,19926],"ref":[19906,19908],"id":[19906,19908],"bi":"default"}],"name":["Chapter8","Sum'","add"],"modifiers":null,"kind":"theorem","id":{"range":[19848,19856],"original":true}},{"value":{"range":[20219,20232],"original":true},"type":{"range":[20162,20218],"original":true},"signature":{"range":{"stop":20218,"start":20103},"pp":" {X : Type} {f : X → ℝ} (hf : AbsConvergent' f) (c : ℝ) : AbsConvergent' (c • f) ∧ Sum' (c • f) = c * Sum' f","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Chapter8","Sum'"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","Sum'"]},"ref":{"range":{"stop":20232,"start":20003},"pp":"/-- Proposition 8.2.6 (b) (Absolutely convergent series laws) / Exercise 8.2.3 -/\ntheorem smul {X : Type} {f : X → ℝ} (hf : AbsConvergent' f) (c : ℝ) :\n    AbsConvergent' (c • f) ∧ Sum' (c • f) = c * Sum' f := by sorry","original":true},"params":[{"type":[20106,20110],"ref":[20104,20105],"id":[20104,20105],"bi":"implicit"},{"type":[20115,20124],"ref":[20113,20114],"id":[20113,20114],"bi":"implicit"},{"type":[20131,20147],"ref":[20127,20129],"id":[20127,20129],"bi":"default"},{"type":[20153,20156],"ref":[20150,20151],"id":[20150,20151],"bi":"default"}],"name":["Chapter8","Sum'","smul"],"modifiers":null,"kind":"theorem","id":{"range":[20093,20102],"original":true}},{"value":{"range":[20487,20601],"original":true},"type":{"range":[20431,20486],"original":true},"signature":{"range":{"stop":20486,"start":20356},"pp":" {X : Type} {f g : X → ℝ} (hf : AbsConvergent' f) (hg : AbsConvergent' g) :\n  AbsConvergent' (f - g) ∧ Sum' (f - g) = Sum' f - Sum' g","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Chapter8","Sum'"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","Sum'"]},"ref":{"range":{"stop":20601,"start":20234},"pp":"/-- This law is not explicitly stated in Proposition 8.2.6, but follows easily from parts (a) and (b).-/\ntheorem sub {X : Type} {f g : X → ℝ} (hf : AbsConvergent' f) (hg : AbsConvergent' g) :\n    AbsConvergent' (f - g) ∧ Sum' (f - g) = Sum' f - Sum' g :=\n  by\n  convert add hf (smul hg (-1)).1 using 2\n  . simp; abel\n  . congr; simp; abel\n  rw [(smul hg (-1)).2]; ring","original":true},"params":[{"type":[20359,20363],"ref":[20357,20358],"id":[20357,20358],"bi":"implicit"},{"type":[20370,20379],"ref":[20366,20367],"id":[20366,20367],"bi":"implicit"},{"type":[20370,20379],"ref":[20368,20369],"id":[20368,20369],"bi":"implicit"},{"type":[20386,20402],"ref":[20382,20384],"id":[20382,20384],"bi":"default"},{"type":[20409,20425],"ref":[20405,20407],"id":[20405,20407],"bi":"default"}],"name":["Chapter8","Sum'","sub"],"modifiers":null,"kind":"theorem","id":{"range":[20347,20355],"original":true}},{"value":{"range":[21003,21016],"original":true},"type":{"range":[20898,21002],"original":true},"signature":{"range":{"stop":21002,"start":20801},"pp":" {X : Type} {f : X → ℝ} (hf : AbsConvergent' f) {X₁ X₂ : Set X} (hdisj : Disjoint X₁ X₂) :\n  Sum' (fun x : (X₁ ∪ X₂ : Set X) ↦ f x) = Sum' (fun x : X₁ ↦ f x) + Sum' (fun x : X₂ ↦ f x)","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Chapter8","Sum'"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","Sum'"]},"ref":{"range":{"stop":21016,"start":20603},"pp":"/-- Proposition 8.2.6 (c) (Absolutely convergent series laws) / Exercise 8.2.3.  The first\n    part of this proposition has been moved to `AbsConvergent'.subtype`. -/\ntheorem of_disjoint_union {X : Type} {f : X → ℝ} (hf : AbsConvergent' f) {X₁ X₂ : Set X} (hdisj : Disjoint X₁ X₂) :\n    Sum' (fun x : (X₁ ∪ X₂ : Set X) ↦ f x) = Sum' (fun x : X₁ ↦ f x) + Sum' (fun x : X₂ ↦ f x) := by sorry","original":true},"params":[{"type":[20804,20808],"ref":[20802,20803],"id":[20802,20803],"bi":"implicit"},{"type":[20813,20822],"ref":[20811,20812],"id":[20811,20812],"bi":"implicit"},{"type":[20829,20845],"ref":[20825,20827],"id":[20825,20827],"bi":"default"},{"type":[20860,20865],"ref":[20848,20852],"id":[20848,20852],"bi":"implicit"},{"type":[20860,20865],"ref":[20853,20857],"id":[20853,20857],"bi":"implicit"},{"type":[20875,20893],"ref":[20868,20873],"id":[20868,20873],"bi":"default"}],"name":["Chapter8","Sum'","of_disjoint_union"],"modifiers":null,"kind":"theorem","id":{"range":[20778,20800],"original":true}},{"value":{"range":[21246,21259],"original":true},"type":{"range":[21199,21245],"original":true},"signature":{"range":{"stop":21245,"start":21149},"pp":" {X : Type} {f : X → ℝ} (hf : AbsConvergent' f) : Sum' (fun x : (.univ : Set X) ↦ f x) = Sum' f","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Chapter8","Sum'"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","Sum'"]},"ref":{"range":{"stop":21259,"start":21018},"pp":"/-- This technical claim, the analogue of `tsum_univ`, is required due to the way Mathlib handles\n    sets.-/\ntheorem of_univ {X : Type} {f : X → ℝ} (hf : AbsConvergent' f) : Sum' (fun x : (.univ : Set X) ↦ f x) = Sum' f := by\n  sorry","original":true},"params":[{"type":[21152,21156],"ref":[21150,21151],"id":[21150,21151],"bi":"implicit"},{"type":[21161,21170],"ref":[21159,21160],"id":[21159,21160],"bi":"implicit"},{"type":[21177,21193],"ref":[21173,21175],"id":[21173,21175],"bi":"default"}],"name":["Chapter8","Sum'","of_univ"],"modifiers":null,"kind":"theorem","id":{"range":[21136,21148],"original":true}},{"value":{"range":[21434,21447],"original":true},"type":{"range":[21379,21433],"original":true},"signature":{"range":{"stop":21433,"start":21282},"pp":" {X Y : Type} {f : X → ℝ} (hf : AbsConvergent' f) {φ : Y → X} (hφ : Function.Bijective φ) :\n  AbsConvergent' (f ∘ φ) ∧ Sum' f = Sum' (f ∘ φ)","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Chapter8","Sum'"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8","Sum'"]},"ref":{"range":{"stop":21447,"start":21261},"pp":"theorem of_comp {X Y : Type} {f : X → ℝ} (hf : AbsConvergent' f) {φ : Y → X} (hφ : Function.Bijective φ) :\n    AbsConvergent' (f ∘ φ) ∧ Sum' f = Sum' (f ∘ φ) := by sorry","original":true},"params":[{"type":[21287,21291],"ref":[21283,21284],"id":[21283,21284],"bi":"implicit"},{"type":[21287,21291],"ref":[21285,21286],"id":[21285,21286],"bi":"implicit"},{"type":[21296,21305],"ref":[21294,21295],"id":[21294,21295],"bi":"implicit"},{"type":[21312,21328],"ref":[21308,21310],"id":[21308,21310],"bi":"default"},{"type":[21335,21342],"ref":[21331,21333],"id":[21331,21333],"bi":"implicit"},{"type":[21352,21373],"ref":[21347,21350],"id":[21347,21350],"bi":"default"}],"name":["Chapter8","Sum'","of_comp"],"modifiers":null,"kind":"theorem","id":{"range":[21269,21281],"original":true}},{"value":{"range":[21712,21725],"original":true},"type":{"range":[21606,21709],"original":true},"signature":{"range":{"stop":21709,"start":21522},"pp":" {a : ℕ → ℝ} (ha : (a : Series).converges) (ha' : ¬(a : Series).absConverges) :\n  ¬AbsConvergent (fun n : {n | a n ≥ 0} ↦ a n) ∧ ¬AbsConvergent (fun n : {n | a n < 0} ↦ a n)","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8"]},"ref":{"range":{"stop":21725,"start":21449},"pp":"/-- Lemma 8.2.7 / Exercise 8.2.4 -/\ntheorem divergent_parts_of_divergent {a : ℕ → ℝ} (ha : (a : Series).converges) (ha' : ¬(a : Series).absConverges) :\n    ¬AbsConvergent (fun n : {n | a n ≥ 0} ↦ a n) ∧ ¬AbsConvergent (fun n : {n | a n < 0} ↦ a n) := by sorry","original":true},"params":[{"type":[21526,21537],"ref":[21523,21524],"id":[21523,21524],"bi":"implicit"},{"type":[21544,21564],"ref":[21540,21542],"id":[21540,21542],"bi":"default"},{"type":[21574,21600],"ref":[21569,21572],"id":[21569,21572],"bi":"default"}],"name":["Chapter8","divergent_parts_of_divergent"],"modifiers":null,"kind":"theorem","id":{"range":[21493,21521],"original":true}},{"value":{"range":[22000,23830],"original":true},"type":{"range":[21930,21997],"original":true},"signature":{"range":{"stop":21997,"start":21838},"pp":" {a : ℕ → ℝ} (ha : (a : Series).converges) (ha' : ¬(a : Series).absConverges) (L : ℝ) :\n  ∃ f : ℕ → ℕ, Bijective f ∧ (a ∘ f : Series).convergesTo L","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8"]},"ref":{"range":{"stop":23830,"start":21727},"pp":"/-- Theorem 8.2.8 (Riemann rearrangement theorem) / Exercise 8.2.5 -/\ntheorem permute_convergesTo_of_divergent {a : ℕ → ℝ} (ha : (a : Series).converges) (ha' : ¬(a : Series).absConverges)\n    (L : ℝ) : ∃ f : ℕ → ℕ, Bijective f ∧ (a ∘ f : Series).convergesTo L := by\n  -- This proof is written to follow the structure of the original text.\n  \n  choose h1 h2 using divergent_parts_of_divergent ha ha'\n  set A_plus := {n | a n ≥ 0}\n  set A_minus := {n | a n < 0}\n  have hdisj : Disjoint A_plus A_minus := by rw [Set.disjoint_iff_inter_eq_empty]; ext; simp [A_plus, A_minus]\n  have hunion : A_plus ∪ A_minus = .univ := by ext; simp [A_plus, A_minus]; grind\n  have hA_plus_inf : Infinite A_plus := sorry\n  have hA_minus_inf : Infinite A_minus := sorry\n  obtain ⟨a_plus, ha_plus_bij, ha_plus_mono⟩ := (Nat.monotone_enum_of_infinite A_plus).exists\n  obtain ⟨a_minus, ha_minus_bij, ha_minus_mono⟩ := (Nat.monotone_enum_of_infinite A_minus).exists\n  let F : (n : ℕ) → ((m : ℕ) → m < n → ℕ) → ℕ := fun j n' ↦\n    if ∑ i : Fin j, n' i (by simp) > L then Nat.min ({n ∈ A_plus | ∀ i : Fin j, n ≠ n' i (by simp)})\n    else Nat.min ({n ∈ A_minus | ∀ i : Fin j, n ≠ n' i (by simp)})\n  let n' : ℕ → ℕ := Nat.strongRec F\n  have hn' (j : ℕ) :\n    n' j =\n      if ∑ i : Fin j, n' i > L then Nat.min ({n ∈ A_plus | ∀ i : Fin j, n ≠ n' i})\n      else Nat.min ({n ∈ A_minus | ∀ i : Fin j, n ≠ n' i}) :=\n    Nat.strongRec.eq_def _ j\n  have hn'_plus_inf (j : ℕ) : Infinite ({n ∈ A_plus | ∀ i : Fin j, n ≠ n' i}) := by sorry\n  have hn'_minus_inf (j : ℕ) : Infinite ({n ∈ A_minus | ∀ i : Fin j, n ≠ n' i}) := by sorry\n  have hn'_inj : Injective n' := by sorry\n  have h_case_I : Infinite {j | ∑ i : Fin j, n' i > L} := by sorry\n  have h_case_II : Infinite {j | ∑ i : Fin j, n' i ≤ L} := by sorry\n  have hn'_surj : Surjective n' := by sorry\n  have hconv : atTop.Tendsto (a ∘ n') (nhds 0) := by sorry\n  have hsum : (a ∘ n' : Series).convergesTo L := by sorry\n  use n'\n  refine ⟨⟨hn'_inj, hn'_surj⟩, ?_⟩; convert hsum","original":true},"params":[{"type":[21842,21853],"ref":[21839,21840],"id":[21839,21840],"bi":"implicit"},{"type":[21860,21880],"ref":[21856,21858],"id":[21856,21858],"bi":"default"},{"type":[21890,21916],"ref":[21885,21888],"id":[21885,21888],"bi":"default"},{"type":[21921,21924],"ref":[21919,21920],"id":[21919,21920],"bi":"default"}],"name":["Chapter8","permute_convergesTo_of_divergent"],"modifiers":null,"kind":"theorem","id":{"range":[21805,21837],"original":true}},{"value":{"range":[24089,24102],"original":true},"type":{"range":[23977,24088],"original":true},"signature":{"range":{"stop":24088,"start":23892},"pp":" {a : ℕ → ℝ} (ha : (a : Series).converges) (ha' : ¬(a : Series).absConverges) :\n  ∃ f : ℕ → ℕ, Bijective f ∧ atTop.Tendsto (fun N ↦ ((a ∘ f : Series).partial N : EReal)) (nhds ⊤)","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8"]},"ref":{"range":{"stop":24102,"start":23832},"pp":"/-- Exercise 8.2.6 -/\ntheorem permute_diverges_of_divergent {a : ℕ → ℝ} (ha : (a : Series).converges) (ha' : ¬(a : Series).absConverges) :\n    ∃ f : ℕ → ℕ, Bijective f ∧ atTop.Tendsto (fun N ↦ ((a ∘ f : Series).partial N : EReal)) (nhds ⊤) := by sorry","original":true},"params":[{"type":[23896,23907],"ref":[23893,23894],"id":[23893,23894],"bi":"implicit"},{"type":[23914,23934],"ref":[23910,23912],"id":[23910,23912],"bi":"default"},{"type":[23944,23970],"ref":[23939,23942],"id":[23939,23942],"bi":"default"}],"name":["Chapter8","permute_diverges_of_divergent"],"modifiers":null,"kind":"theorem","id":{"range":[23862,23891],"original":true}},{"value":{"range":[24340,24353],"original":true},"type":{"range":[24228,24339],"original":true},"signature":{"range":{"stop":24339,"start":24143},"pp":" {a : ℕ → ℝ} (ha : (a : Series).converges) (ha' : ¬(a : Series).absConverges) :\n  ∃ f : ℕ → ℕ, Bijective f ∧ atTop.Tendsto (fun N ↦ ((a ∘ f : Series).partial N : EReal)) (nhds ⊥)","original":true},"scopeInfo":{"varDecls":[],"scopedOpenDecl":[["Function"],["Finset"],["Chapter7","Series"],["Chapter8"],["Filter"],["Chapter7"]],"openDecl":[{"simple":{"namespace":["Filter"],"except":[]}},{"simple":{"namespace":["Function"],"except":[]}},{"simple":{"namespace":["Finset"],"except":[]}},{"simple":{"namespace":["Chapter7","Series"],"except":[]}},{"simple":{"namespace":["Chapter7"],"except":[]}}],"omitVars":[],"levelNames":[],"includeVars":[],"currNamespace":["Chapter8"]},"ref":{"range":{"stop":24353,"start":24104},"pp":"theorem permute_diverges_of_divergent' {a : ℕ → ℝ} (ha : (a : Series).converges) (ha' : ¬(a : Series).absConverges) :\n    ∃ f : ℕ → ℕ, Bijective f ∧ atTop.Tendsto (fun N ↦ ((a ∘ f : Series).partial N : EReal)) (nhds ⊥) := by sorry","original":true},"params":[{"type":[24147,24158],"ref":[24144,24145],"id":[24144,24145],"bi":"implicit"},{"type":[24165,24185],"ref":[24161,24163],"id":[24161,24163],"bi":"default"},{"type":[24195,24221],"ref":[24190,24193],"id":[24190,24193],"bi":"default"}],"name":["Chapter8","permute_diverges_of_divergent'"],"modifiers":null,"kind":"theorem","id":{"range":[24112,24142],"original":true}}]
